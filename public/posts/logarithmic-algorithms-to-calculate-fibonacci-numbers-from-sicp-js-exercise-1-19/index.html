<!doctype html>

<html lang="en">

<head>
  <title>Logarithmic Algorithms to Calculate Fibonacci Numbers From SICP JS Exercise 1.19  - Rat&#39;s blog</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Rat&#39;s 2nd blog" />
<meta name="author" content="Rat" /><meta property="og:title" content="Logarithmic Algorithms to Calculate Fibonacci Numbers From SICP JS Exercise 1.19 " />
<meta property="og:description" content="Logarithmic algorithms to calculate Fibonacci numbers - from SICP-JS Exercise 1.19 Preface We all know the Fibonacci sequence
$$ \begin{equation} Fib(k)= \begin{cases} 0 &amp; &amp; (k == 0) \
1 &amp; &amp; (k == 1) \" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.rye-catcher.codes/posts/logarithmic-algorithms-to-calculate-fibonacci-numbers-from-sicp-js-exercise-1-19/" />
<meta property="article:published_time" content="2020-08-19T00:31:21+08:00" />
<meta property="article:modified_time" content="2020-08-19T00:31:21+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Logarithmic Algorithms to Calculate Fibonacci Numbers From SICP JS Exercise 1.19 "/>
<meta name="twitter:description" content="Logarithmic algorithms to calculate Fibonacci numbers - from SICP-JS Exercise 1.19 Preface We all know the Fibonacci sequence
$$ \begin{equation} Fib(k)= \begin{cases} 0 &amp; &amp; (k == 0) \
1 &amp; &amp; (k == 1) \"/>

<meta name="generator" content="Hugo 0.74.3" />
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://www.rye-catcher.codes/fontawesome/css/all.min.css" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  
  
  <link rel="stylesheet" type="text/css" href="https://www.rye-catcher.codes/css/styles.css" /></head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="https://www.rye-catcher.codes/">Rat&rsquo;s blog</a>
            </h1>

      <ul id="social-media">
             <li>
               <a href="https://github.com/Rye-Catcher" title="GitHub">
               <i class="fab fa-github fa-lg"></i>
               </a>
             </li>
      </ul>
      
      <p><em>An unexamined life is not worth living</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="https://www.rye-catcher.codes/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://www.rye-catcher.codes/about/">
                <i class="fa-li fa  fa-lg"></i><span>About</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>




<article>

    <h1>Logarithmic Algorithms to Calculate Fibonacci Numbers From SICP JS Exercise 1.19 </h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2020-08-19T00:31:21&#43;08:00">Aug 19, 2020</time>
        </li>
        
        <li>
            Categories:
            <em>
                
                    
                    <a href="https://www.rye-catcher.codes/categories/sicp">SICP</a>
                
            </em>
        </li>
        

        
        <li>
            <em>
                
                    
                    <a href="https://www.rye-catcher.codes/tags/sicp">#SICP</a>
                
                    , 
                    <a href="https://www.rye-catcher.codes/tags/fibonacci">#Fibonacci</a>
                
            </em>
        </li>
        

        <li>4 minutes read</li>
    </ul>
</aside>

    

    


    <h2 id="logarithmic-algorithms-to-calculate-fibonacci-numbers---from-sicp-js-exercise-119">Logarithmic algorithms to calculate Fibonacci numbers - from SICP-JS Exercise 1.19</h2>
<h3 id="preface">Preface</h3>
<p>We all know the Fibonacci sequence</p>
<p>$$
\begin{equation}
Fib(k)=
\begin{cases}
0 &amp; &amp; (k == 0) \<br>
1 &amp; &amp; (k == 1) \<br>
Fib(k-1) + Fib(k-2) &amp; &amp; (k &gt;= 2)
\end{cases}
\end{equation}
$$</p>
<p>and the Fibonacci number $F_n$ denotes the nth term of this sequence</p>
<p>By the definition we can easily write a recursive function to compute $F_n$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calc_fib</span>(<span style="color:#a6e22e">n</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>
	       <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span>
	       <span style="color:#f92672">:</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">1</span>
	         <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span>
	         <span style="color:#f92672">:</span> <span style="color:#a6e22e">calc_fib</span>(<span style="color:#a6e22e">n</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">calc_fib</span>(<span style="color:#a6e22e">n</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>);
}
<span style="color:#a6e22e">calc_fib</span>(<span style="color:#ae81ff">3</span>);
<span style="color:#75715e">//output: 2
</span></code></pre></div><p>But this takes time complexity of $O(n)$, that is to the number of steps to calculate basically grows linearly</p>
<p>Here the article will introduce two ways to computer $F_n$ in $O(\log n)$. The first methods comes from the exercise 1.19 in the book <a href="https://source-academy.github.io/sicp/index.html">Structure and Interpretation of Computer Programs — JavaScript Adaptation</a>, which is the textbook used in CS1101S module of NUS. Before you read this, I suggest know how to compute $n^k$ in $O(\log k)$</p>
<h3 id="method-1">Method #1</h3>
<p>This is a constructive way to me. We define a way of transform a pair of numbers $(a, b)$, this transformation needs two parameters, we name $p, q$ here.</p>
<p>We define that, a pair of numbers $(a,b)$, after the transformation $T(p, q)$, becomes $(a(p + q) + bq, bp + aq)$.</p>
<p>You may ask: &ldquo;wait, what, how the * this is related to Fib&rdquo;, pls keep reading</p>
<p>Let $p =0, q = 1$, and you will surprisingly find that $(F_{n}, F_{n-1})$ becomes $(F_{n+1}, F_n)$ after the transformation $T(p,q)$</p>
<p>OK, now at least we know this <em>is</em> related to Fibonacci numbers. In fact after doing $n-1$ times $T(p, q)$ you can obtain $(F_n, F_{n-1})$ from pair $(F_1, F_0)$. BUT, its still $O(n)$.</p>
<p>Now, a lazy but clever person comes up with a good idea so that he could do less work, what if I change the parameter $p, q$ to something else $p&rsquo;, q'$ so that the effect of $T(p&rsquo;, q&rsquo;)$ is the same as using two times of $T(p, q)$ ? That is to say $T^2(p, q) = T(p&rsquo;, q&rsquo;)$</p>
<p>You can use your algebra knowledge to obtain that $p&rsquo; = p^2 + q^2, q&rsquo; = 2pq + q^2$.  So if you do $n$ times transformation $T(p, q)$ (suppose $n$ is even), it is equal to do $\frac{n}{2}$ times $T(p&rsquo;, q&rsquo;)$ . Or we could say: $T^n(p, q) = T^{\frac{n}{2}}(p&rsquo;, q&rsquo;)$</p>
<p>Now recall how we do the logarithmic algorithms for exponentiation, we can have following programs</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calc_fib</span>(<span style="color:#a6e22e">p</span>, <span style="color:#a6e22e">q</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">k</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">k</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> 
	       <span style="color:#f92672">?</span> <span style="color:#a6e22e">is_even</span>(<span style="color:#a6e22e">k</span>)
	         <span style="color:#f92672">?</span> <span style="color:#a6e22e">calc_fib</span>(<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">q</span>, 
                        <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">q</span>, 
                        <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">k</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)
	         <span style="color:#f92672">:</span> <span style="color:#a6e22e">calc_fib</span>(<span style="color:#a6e22e">p</span>, <span style="color:#a6e22e">q</span>, 
                        <span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">*</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">q</span>), 
                        <span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">q</span>, 
                        <span style="color:#a6e22e">k</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
	       <span style="color:#f92672">:</span> <span style="color:#a6e22e">b</span>;
}
</code></pre></div><p>To compute $F_n$, the time complexity is $O(\log n)$</p>
<h3 id="method-2">Method #2</h3>
<blockquote>
<p>WARNING: You better know the matrix manipulation before reading this section</p>
</blockquote>
<p>In the method we define such transformation $T(p, q)$. But it is an abstract function, right? Here we are going to give a <strong>REAL</strong> transformation by matrix manipulation.</p>
<blockquote>
<p>WARNING: Please get ready to see a true magic</p>
</blockquote>
<h1 id="right">$$
\left[
\begin{matrix}
F_n &amp; F_{n-1} \<br>
F_{n-1} &amp; F_{n-2}
\end{matrix}
\right]
\cdot
\left[
\begin{matrix}
1 &amp; 1 \<br>
1 &amp;0
\end{matrix}
\right]</h1>
<p>\left[
\begin{matrix}
F_{n+1} &amp; F_{n} \<br>
F_{n} &amp; F_{n-1}
\end{matrix}
\right]
$$</p>
<p>So we do $n$  times manipulation and will get $F_{n+1}$</p>
<p>But&hellip;remember matrix manipulation has the property of associativity? e.g. $A \cdot B \cdot C = A \cdot (B \cdot C)$, $A, B, C$ all denoted a matrix.</p>
<p>So let $B$ denotes</p>
<p>$$
\left[
\begin{matrix}
1 &amp; 1 \<br>
1 &amp;0
\end{matrix}
\right]
$$</p>
<p>$n$ times transformation is :</p>
<h1 id="b--n">$$
\left[
\begin{matrix}
F_n &amp; F_{n-1} \<br>
F_{n-1} &amp; F_{n-2}
\end{matrix}
\right]
\cdot
B ^ n</h1>
<p>\left[
\begin{matrix}
F_{n+1} &amp; F_{n} \<br>
F_{n} &amp; F_{n-1}
\end{matrix}
\right]
$$</p>
<p>And, in fact we can apply the logarithmic algorithm to matrix exponentiation. So the time complexity becomes $O(\log n)$. Since I haven&rsquo;t got a good way to implement matrix and matrix manipulation in <em>source</em> language, I will not give the code here.</p>
<h3 id="remark">Remark</h3>
<p>In fact we can find a instance for the transformation in <strong>Method #1</strong>, in matrix form.</p>
<p>$$
\left[
\begin{matrix}
0 &amp; 0 \<br>
b &amp; a
\end{matrix}
\right]
\cdot
\left[
\begin{matrix}
p &amp; q \<br>
q &amp; (p+q)
\end{matrix}
\right]
$$</p>
<p>notice that</p>
<h1 id="right-1">$$
\left[
\begin{matrix}
p &amp; q \<br>
q &amp; (p+q)
\end{matrix}
\right]
\cdot
\left[
\begin{matrix}
p &amp; q \<br>
q &amp; (p+q)
\end{matrix}
\right]</h1>
<h1 id="right-2">\left[
\begin{matrix}
p^2 + q^2 &amp; 2pq +q^2 \<br>
2pq +q^2 &amp; p^2 + 2pq+2q^2
\end{matrix}
\right]</h1>
<p>\left[
\begin{matrix}
p&rsquo; &amp; q&rsquo; \<br>
q&rsquo; &amp; (p'+q&rsquo;)
\end{matrix}
\right]
$$</p>
<h3 id="reference">Reference</h3>
<p><a href="https://source-academy.github.io/sicp/index.html">Interpretation of Computer Programs — JavaScript Adaptation</a>, 1.2.4, Exercise 1.19</p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="https://www.rye-catcher.codes/posts/my-first-post/"><i class="fa fa-chevron-circle-left"></i> My First Post</a>
        </li>
        
        
    </ul>
</section>
  
    
        <section id="utterances"></section>

<script>
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        let s = document.createElement("script");
        s.setAttribute("repo", "Rye-Catcher\/hugo-blog");
        s.src = "https://utteranc.es/client.js";
        
          s.setAttribute("issue-term", "url");
        
        
        document.getElementById("utterances").innerHTML = "";
        document.getElementById("utterances").appendChild(s);
    } else {
        let s = document.createElement("script");
        s.setAttribute("repo", "Rye-Catcher\/hugo-blog");
        s.src = "https://utteranc.es/client.js";
        
          s.setAttribute("issue-term", "url");
        
        
        document.getElementById("utterances").innerHTML = "";
        document.getElementById("utterances").appendChild(s);
    }
</script>

    
    
  





</main>
    <footer>
        <h6>Copyright © 2020 - Rat |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="https://www.rye-catcher.codes/index.xml">Subscribe </a></h6>
    </footer>
</div>
<script src="https://www.rye-catcher.codes/js/scripts.js"></script>

</body>

</html>

